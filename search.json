[{"title":"使用docker-swarm搭建分布式zookeeper集群","url":"http://mosasaur.cn/2.html","content":"<h3 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h3><p>今天需要搭建zookeeper集群，跑到docker hub搜了一下，发现有官方镜像，并且已经有了集群化部署的yaml文件，本人很懒，就照着官方的来吧</p>\n<h3 id=\"踩坑\"><a href=\"#踩坑\" class=\"headerlink\" title=\"踩坑\"></a>踩坑</h3><p>先上官方yaml，由于官方yaml是V2版本，略作修改<br><figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"attr\">version:</span> <span class=\"string\">'3'</span></div><div class=\"line\"><span class=\"attr\">services:</span></div><div class=\"line\"><span class=\"attr\">    zoo1:</span></div><div class=\"line\"><span class=\"attr\">        image:</span> zookeeper</div><div class=\"line\"><span class=\"attr\">        deploy:</span></div><div class=\"line\"><span class=\"attr\">            restart_policy:</span></div><div class=\"line\"><span class=\"attr\">                condition:</span> any</div><div class=\"line\"><span class=\"attr\">        environment:</span></div><div class=\"line\"><span class=\"attr\">            ZOO_MY_ID:</span> <span class=\"number\">1</span></div><div class=\"line\"><span class=\"attr\">            ZOO_SERVERS:</span> server<span class=\"number\">.1</span>=zoo1:<span class=\"number\">2888</span>:<span class=\"number\">3888</span> server<span class=\"number\">.2</span>=zoo2:<span class=\"number\">2888</span>:<span class=\"number\">3888</span> server<span class=\"number\">.3</span>=zoo3:<span class=\"number\">2888</span>:<span class=\"number\">3888</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"attr\">    zoo2:</span></div><div class=\"line\"><span class=\"attr\">        image:</span> zookeeper</div><div class=\"line\"><span class=\"attr\">        deploy:</span></div><div class=\"line\"><span class=\"attr\">            restart_policy:</span></div><div class=\"line\"><span class=\"attr\">                condition:</span> any</div><div class=\"line\"><span class=\"attr\">        environment:</span></div><div class=\"line\"><span class=\"attr\">            ZOO_MY_ID:</span> <span class=\"number\">2</span></div><div class=\"line\"><span class=\"attr\">            ZOO_SERVERS:</span> server<span class=\"number\">.1</span>=zoo1:<span class=\"number\">2888</span>:<span class=\"number\">3888</span> server<span class=\"number\">.2</span>=zoo2:<span class=\"number\">2888</span>:<span class=\"number\">3888</span> server<span class=\"number\">.3</span>=zoo3:<span class=\"number\">2888</span>:<span class=\"number\">3888</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"attr\">    zoo3:</span></div><div class=\"line\"><span class=\"attr\">        image:</span> zookeeper</div><div class=\"line\"><span class=\"attr\">        deploy:</span></div><div class=\"line\"><span class=\"attr\">            restart_policy:</span></div><div class=\"line\"><span class=\"attr\">                condition:</span> any</div><div class=\"line\"><span class=\"attr\">        environment:</span></div><div class=\"line\"><span class=\"attr\">            ZOO_MY_ID:</span> <span class=\"number\">3</span></div><div class=\"line\"><span class=\"attr\">            ZOO_SERVERS:</span> server<span class=\"number\">.1</span>=zoo1:<span class=\"number\">2888</span>:<span class=\"number\">3888</span> server<span class=\"number\">.2</span>=zoo2:<span class=\"number\">2888</span>:<span class=\"number\">3888</span> server<span class=\"number\">.3</span>=zoo3:<span class=\"number\">2888</span>:<span class=\"number\">3888</span></div></pre></td></tr></table></figure></p>\n<p>官方办事，我放心开始docker stack deploy -c zk.yaml zk_cluster，一会儿果然3个zk容器起来了，来来来，进容器看看集群搭好了没，好吧，别说集群了zk服务都没起来。。。颇为无语，查看端口使用情况，3888占用了，2888没用，什么情况，手动启动一下，显示started，然并卵。看日志，hostname解析了不明白怎么创建不了集群，自己捣鼓了一下午，无果，只能求助google大神，zookeeper cluster can’t run in docker swarm。找到了，给你们贴个链接吧<a href=\"https://forums.docker.com/t/cannot-get-zookeeper-to-work-running-in-docker-using-swarm-mode/27109/7\" target=\"_blank\" rel=\"external\">zk</a><br>再上个能跑的yaml<br><figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"attr\">version:</span> <span class=\"string\">'3'</span></div><div class=\"line\"><span class=\"attr\">services:</span></div><div class=\"line\"><span class=\"attr\">    zoo1:</span></div><div class=\"line\"><span class=\"attr\">        image:</span> zookeeper</div><div class=\"line\"><span class=\"attr\">        deploy:</span></div><div class=\"line\"><span class=\"attr\">            restart_policy:</span></div><div class=\"line\"><span class=\"attr\">                condition:</span> any</div><div class=\"line\"><span class=\"attr\">        ports:</span></div><div class=\"line\"><span class=\"bullet\">            -</span> <span class=\"number\">2181</span>:<span class=\"number\">2181</span></div><div class=\"line\"><span class=\"attr\">        environment:</span></div><div class=\"line\"><span class=\"attr\">            ZOO_MY_ID:</span> <span class=\"number\">1</span></div><div class=\"line\"><span class=\"attr\">            ZOO_SERVERS:</span> server<span class=\"number\">.1</span>=<span class=\"number\">0.0</span><span class=\"number\">.0</span><span class=\"number\">.0</span>:<span class=\"number\">2888</span>:<span class=\"number\">3888</span> server<span class=\"number\">.2</span>=zoo2:<span class=\"number\">2888</span>:<span class=\"number\">3888</span> server<span class=\"number\">.3</span>=zoo3:<span class=\"number\">2888</span>:<span class=\"number\">3888</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"attr\">    zoo2:</span></div><div class=\"line\"><span class=\"attr\">        image:</span> zookeeper</div><div class=\"line\"><span class=\"attr\">        deploy:</span></div><div class=\"line\"><span class=\"attr\">            restart_policy:</span></div><div class=\"line\"><span class=\"attr\">                condition:</span> any</div><div class=\"line\"><span class=\"attr\">        ports:</span></div><div class=\"line\"><span class=\"bullet\">            -</span> <span class=\"number\">2182</span>:<span class=\"number\">2181</span></div><div class=\"line\"><span class=\"attr\">        environment:</span></div><div class=\"line\"><span class=\"attr\">            ZOO_MY_ID:</span> <span class=\"number\">2</span></div><div class=\"line\"><span class=\"attr\">            ZOO_SERVERS:</span> server<span class=\"number\">.1</span>=zoo1:<span class=\"number\">2888</span>:<span class=\"number\">3888</span> server<span class=\"number\">.2</span>=<span class=\"number\">0.0</span><span class=\"number\">.0</span><span class=\"number\">.0</span>:<span class=\"number\">2888</span>:<span class=\"number\">3888</span> server<span class=\"number\">.3</span>=zoo3:<span class=\"number\">2888</span>:<span class=\"number\">3888</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"attr\">    zoo3:</span></div><div class=\"line\"><span class=\"attr\">        image:</span> zookeeper</div><div class=\"line\"><span class=\"attr\">        deploy:</span></div><div class=\"line\"><span class=\"attr\">            restart_policy:</span></div><div class=\"line\"><span class=\"attr\">                condition:</span> any</div><div class=\"line\"><span class=\"attr\">        ports:</span></div><div class=\"line\"><span class=\"bullet\">            -</span> <span class=\"number\">2183</span>:<span class=\"number\">2181</span></div><div class=\"line\"><span class=\"attr\">        environment:</span></div><div class=\"line\"><span class=\"attr\">            ZOO_MY_ID:</span> <span class=\"number\">3</span></div><div class=\"line\"><span class=\"attr\">            ZOO_SERVERS:</span> server<span class=\"number\">.1</span>=zoo1:<span class=\"number\">2888</span>:<span class=\"number\">3888</span> server<span class=\"number\">.2</span>=zoo2:<span class=\"number\">2888</span>:<span class=\"number\">3888</span> server<span class=\"number\">.3</span>=<span class=\"number\">0.0</span><span class=\"number\">.0</span><span class=\"number\">.0</span>:<span class=\"number\">2888</span>:<span class=\"number\">3888</span></div></pre></td></tr></table></figure></p>\n<h3 id=\"结尾\"><a href=\"#结尾\" class=\"headerlink\" title=\"结尾\"></a>结尾</h3><p>好吧总算是把集群搞好了，这个教训告诉我，官方的东西也是会坑人的。。。</p>\n","categories":[],"tags":["Docker","Linux"]},{"title":"使用docker-swarm搭建分布式redis集群","url":"http://mosasaur.cn/1.html","content":"<h3 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h3><p>今天要使用docker搭建redis cluster,首先还是镜像，redis官方镜像表示玩不来啊，还是自定义吧</p>\n<h3 id=\"镜像制作\"><a href=\"#镜像制作\" class=\"headerlink\" title=\"镜像制作\"></a>镜像制作</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\">FROM ubuntu:16.04</div><div class=\"line\">LABEL auther=<span class=\"string\">\"wuchenzhi\"</span></div><div class=\"line\">ADD redis-3.2.10.tar.gz /opt/</div><div class=\"line\">ADD redis.conf /opt/</div><div class=\"line\">RUN /bin/bash -c <span class=\"string\">'apt-get update;apt-get -y install vim gcc make ruby rubygems;gem install redis'</span></div><div class=\"line\">WORKDIR /opt/redis-3.2.10/</div><div class=\"line\">RUN /bin/bash -c <span class=\"string\">'make'</span></div><div class=\"line\">EXPOSE 6379</div><div class=\"line\">CMD [<span class=\"string\">\"/bin/bash\"</span>]</div></pre></td></tr></table></figure>\n<p>依然使用ubuntu镜像，安装redis，我们要使用stack模式来构建集群，更改下配置文件支持集群模式，编译需要gcc make，vim纯属个人爱好，redis cluster官方文档说到redis-trib.rb来构建集群，所以ruby rubygems，gem install redis也少不了，CMD个人喜欢/ban/bash,写compose_file再改</p>\n<p>redis.conf就贴个官方的吧，不过还需要关闭保护模式，或者添加bind，redis-trib无法访问<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\">protected-mode no</div><div class=\"line\">port 6379</div><div class=\"line\">cluster-enabled yes</div><div class=\"line\">cluster-config-file nodes.conf</div><div class=\"line\">cluster-node-timeout 5000</div><div class=\"line\">appendonly yes</div></pre></td></tr></table></figure></p>\n<p>镜像就到这里吧，目前看来一切顺利</p>\n<h3 id=\"集群搭建\"><a href=\"#集群搭建\" class=\"headerlink\" title=\"集群搭建\"></a>集群搭建</h3><p>前面已经说到了使用docker stack进行集群部署，先写个compose_file<br><figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"attr\">version:</span> <span class=\"string\">\"3\"</span></div><div class=\"line\"><span class=\"attr\">networks:</span></div><div class=\"line\"><span class=\"attr\">  net:</span></div><div class=\"line\"><span class=\"attr\">services:</span></div><div class=\"line\"><span class=\"attr\">  redis1:</span></div><div class=\"line\"><span class=\"attr\">    image:</span> wuchenzhi:redis</div><div class=\"line\"><span class=\"attr\">    deploy:</span></div><div class=\"line\"><span class=\"attr\">      replicas:</span> <span class=\"number\">1</span></div><div class=\"line\"><span class=\"attr\">      restart_policy:</span></div><div class=\"line\"><span class=\"attr\">        condition:</span> on-failure</div><div class=\"line\"><span class=\"attr\">        delay:</span> <span class=\"number\">5</span>s</div><div class=\"line\"><span class=\"attr\">        max_attempts:</span> <span class=\"number\">3</span></div><div class=\"line\"><span class=\"attr\">        window:</span> <span class=\"number\">120</span>s</div><div class=\"line\"><span class=\"attr\">    networks:</span></div><div class=\"line\"><span class=\"bullet\">      -</span> net</div><div class=\"line\"><span class=\"attr\">    command:</span> /opt/redis<span class=\"bullet\">-3.2</span><span class=\"number\">.10</span>/src/redis-server /opt/redis.conf</div><div class=\"line\"><span class=\"attr\">  redis2:</span></div><div class=\"line\"><span class=\"attr\">    image:</span> wuchenzhi:redis</div><div class=\"line\"><span class=\"attr\">    deploy:</span></div><div class=\"line\"><span class=\"attr\">      replicas:</span> <span class=\"number\">1</span></div><div class=\"line\"><span class=\"attr\">      restart_policy:</span></div><div class=\"line\"><span class=\"attr\">        condition:</span> on-failure</div><div class=\"line\"><span class=\"attr\">        delay:</span> <span class=\"number\">5</span>s</div><div class=\"line\"><span class=\"attr\">        max_attempts:</span> <span class=\"number\">3</span></div><div class=\"line\"><span class=\"attr\">        window:</span> <span class=\"number\">120</span>s</div><div class=\"line\"><span class=\"attr\">    networks:</span></div><div class=\"line\"><span class=\"bullet\">      -</span> net</div><div class=\"line\"><span class=\"attr\">    command:</span> /opt/redis<span class=\"bullet\">-3.2</span><span class=\"number\">.10</span>/src/redis-server /opt/redis.conf</div><div class=\"line\"><span class=\"attr\">  redis3:</span></div><div class=\"line\"><span class=\"attr\">    image:</span> wuchenzhi:redis</div><div class=\"line\"><span class=\"attr\">    deploy:</span></div><div class=\"line\"><span class=\"attr\">      replicas:</span> <span class=\"number\">1</span></div><div class=\"line\"><span class=\"attr\">      restart_policy:</span></div><div class=\"line\"><span class=\"attr\">        condition:</span> on-failure</div><div class=\"line\"><span class=\"attr\">        delay:</span> <span class=\"number\">5</span>s</div><div class=\"line\"><span class=\"attr\">        max_attempts:</span> <span class=\"number\">3</span></div><div class=\"line\"><span class=\"attr\">        window:</span> <span class=\"number\">120</span>s</div><div class=\"line\"><span class=\"attr\">    networks:</span></div><div class=\"line\"><span class=\"bullet\">      -</span> net</div><div class=\"line\"><span class=\"attr\">    command:</span> /opt/redis<span class=\"bullet\">-3.2</span><span class=\"number\">.10</span>/src/redis-server /opt/redis.conf</div><div class=\"line\"><span class=\"attr\">  redis4:</span></div><div class=\"line\"><span class=\"attr\">    image:</span> wuchenzhi:redis</div><div class=\"line\"><span class=\"attr\">    deploy:</span></div><div class=\"line\"><span class=\"attr\">      replicas:</span> <span class=\"number\">1</span></div><div class=\"line\"><span class=\"attr\">      restart_policy:</span></div><div class=\"line\"><span class=\"attr\">        condition:</span> on-failure</div><div class=\"line\"><span class=\"attr\">        delay:</span> <span class=\"number\">5</span>s</div><div class=\"line\"><span class=\"attr\">        max_attempts:</span> <span class=\"number\">3</span></div><div class=\"line\"><span class=\"attr\">        window:</span> <span class=\"number\">120</span>s</div><div class=\"line\"><span class=\"attr\">    networks:</span></div><div class=\"line\"><span class=\"bullet\">      -</span> net</div><div class=\"line\"><span class=\"attr\">    command:</span> /opt/redis<span class=\"bullet\">-3.2</span><span class=\"number\">.10</span>/src/redis-server /opt/redis.conf</div><div class=\"line\"><span class=\"attr\">  redis5:</span></div><div class=\"line\"><span class=\"attr\">    image:</span> wuchenzhi:redis</div><div class=\"line\"><span class=\"attr\">    deploy:</span></div><div class=\"line\"><span class=\"attr\">      replicas:</span> <span class=\"number\">1</span></div><div class=\"line\"><span class=\"attr\">      restart_policy:</span></div><div class=\"line\"><span class=\"attr\">        condition:</span> on-failure</div><div class=\"line\"><span class=\"attr\">        delay:</span> <span class=\"number\">5</span>s</div><div class=\"line\"><span class=\"attr\">        max_attempts:</span> <span class=\"number\">3</span></div><div class=\"line\"><span class=\"attr\">        window:</span> <span class=\"number\">120</span>s</div><div class=\"line\"><span class=\"attr\">    networks:</span></div><div class=\"line\"><span class=\"bullet\">      -</span> net</div><div class=\"line\"><span class=\"attr\">    command:</span> /opt/redis<span class=\"bullet\">-3.2</span><span class=\"number\">.10</span>/src/redis-server /opt/redis.conf</div><div class=\"line\"><span class=\"attr\">  redis6:</span></div><div class=\"line\"><span class=\"attr\">    image:</span> wuchenzhi:redis</div><div class=\"line\"><span class=\"attr\">    deploy:</span></div><div class=\"line\"><span class=\"attr\">      replicas:</span> <span class=\"number\">1</span></div><div class=\"line\"><span class=\"attr\">      restart_policy:</span></div><div class=\"line\"><span class=\"attr\">        condition:</span> on-failure</div><div class=\"line\"><span class=\"attr\">        delay:</span> <span class=\"number\">5</span>s</div><div class=\"line\"><span class=\"attr\">        max_attempts:</span> <span class=\"number\">3</span></div><div class=\"line\"><span class=\"attr\">        window:</span> <span class=\"number\">120</span>s</div><div class=\"line\"><span class=\"attr\">    networks:</span></div><div class=\"line\"><span class=\"bullet\">      -</span> net</div><div class=\"line\"><span class=\"attr\">    command:</span> /opt/redis<span class=\"bullet\">-3.2</span><span class=\"number\">.10</span>/src/redis-server /opt/redis.conf</div></pre></td></tr></table></figure></p>\n<p>运行docker stack deploy -c redis-cluster.yaml redis-cluster，现在我们有6个redis1-6 server，目前6个redis实例独立运行，并未形成集群。现在我们进入任何一个redis容器，运行/redis-trib.rb create –replicas redis{1-6}:6379，应该就大功告成了吧，然而，并不是redis.trib居然不能解析hostname…必须写ip port，好吧再写个脚本获取ip，然后运行，redis集群就搭建成功了。</p>\n<h3 id=\"结尾\"><a href=\"#结尾\" class=\"headerlink\" title=\"结尾\"></a>结尾</h3><p>前面只是测通了整个redis cluster,如果要直接deploy时就完成集群，那么应该需要添加一个环境变量传输每个redis-server的hostname，这样才能在entrypoint.sh中获取ip。就不赘述了</p>\n","categories":[],"tags":["Docker","Redis"]},{"title":"基于ubuntu官方镜像构建JDK+Tomcat镜像","url":"http://mosasaur.cn/3.html","content":"<h3 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h3><p>今天基于ubuntu16.04官方镜像使用Dockerfile制作JDK+Tomcat镜像，之前一直在看DOCKER DOSC，今天第一次开始实际操作，还是踩了不少的坑。</p>\n<h3 id=\"吹逼中\"><a href=\"#吹逼中\" class=\"headerlink\" title=\"吹逼中\"></a>吹逼中</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">FROM ubuntu:16.04</div></pre></td></tr></table></figure>\n<p>这个就不用多说了<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">LABEL auther=<span class=\"string\">\"wuchenzhi\"</span></div></pre></td></tr></table></figure></p>\n<p>自己写的Dockerfile还是署个名吧，这里使用标签，官方的意思是尽量使用LABEL，不要再使用MAINTAINER了，那就LABEL吧！<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">ADD jdk-8u91-linux-x64.gz /usr/<span class=\"built_in\">local</span>/</div><div class=\"line\">ADD apache-tomcat-8.5.6.tar.gz /usr/<span class=\"built_in\">local</span>/</div></pre></td></tr></table></figure></p>\n<p>使用ADD的时候就遇到坑了，可能是自己官方文档看得不仔细，一开始我把压缩文件ADD到/usr/local后，还使用RUN tar 试图解压文件，但build时报错，文件不存在，回去仔细看文档才发现，ADD命令会自动解压其能识别的压缩方式，后来想想也是，如果需要手动解压，那还需要再手动删除，太麻烦，docker帮我们干了<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">RUN /bin/bash -c <span class=\"string\">'apt-get update;apt-get -y install vim'</span></div></pre></td></tr></table></figure></p>\n<p>RUN 在Linux上默认使用/bin/sh 部分命令还是不能运行的，个人倾向使用/bin/bash<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\">ENV JAVA_HOME /usr/<span class=\"built_in\">local</span>/jdk1.8.0_91</div><div class=\"line\">ENV JRE_HOME <span class=\"variable\">$JAVA_HOME</span>/jre</div><div class=\"line\">ENV CLASSPATH <span class=\"variable\">$JAVA_HOME</span>/lib:<span class=\"variable\">$JRE_HOME</span>/lib</div><div class=\"line\">ENV PATH <span class=\"variable\">$PATH</span>:<span class=\"variable\">$JAVA_HOME</span>/bin:</div><div class=\"line\">ENV TOMCAT_HOME /usr/<span class=\"built_in\">local</span>/apache-tomcat-8.5.6</div></pre></td></tr></table></figure></p>\n<p>ENV 是很好用的，它不光能在Dockerfile生效，还能生效于镜像所生成的容器实例（之前还想着RUN 来修改…）<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">EXPOSE 8080</div><div class=\"line\">CMD [<span class=\"string\">\"/bin/bash\"</span>]</div></pre></td></tr></table></figure></p>\n<h3 id=\"DOCKERFILE\"><a href=\"#DOCKERFILE\" class=\"headerlink\" title=\"DOCKERFILE\"></a>DOCKERFILE</h3><p>最后来个完整的Dockerfile，我的第一篇博文就算结束了，不是很满意，以后回来再改过<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div></pre></td><td class=\"code\"><pre><div class=\"line\">FROM ubuntu:16.04</div><div class=\"line\">LABEL auther=<span class=\"string\">\"wuchenzhi\"</span></div><div class=\"line\">ADD jdk-8u91-linux-x64.gz /usr/<span class=\"built_in\">local</span>/</div><div class=\"line\">ADD apache-tomcat-8.5.6.tar.gz /usr/<span class=\"built_in\">local</span>/</div><div class=\"line\">RUN /bin/bash -c <span class=\"string\">'apt-get update;apt-get -y install vim'</span></div><div class=\"line\">ENV JAVA_HOME /usr/<span class=\"built_in\">local</span>/jdk1.8.0_91</div><div class=\"line\">ENV JRE_HOME <span class=\"variable\">$JAVA_HOME</span>/jre</div><div class=\"line\">ENV CLASSPATH <span class=\"variable\">$JAVA_HOME</span>/lib:<span class=\"variable\">$JRE_HOME</span>/lib</div><div class=\"line\">ENV PATH <span class=\"variable\">$PATH</span>:<span class=\"variable\">$JAVA_HOME</span>/bin:</div><div class=\"line\">ENV TOMCAT_HOME /usr/<span class=\"built_in\">local</span>/apache-tomcat-8.5.6</div><div class=\"line\">EXPOSE 8080</div><div class=\"line\">CMD [<span class=\"string\">\"/bin/bash\"</span>]</div></pre></td></tr></table></figure></p>\n","categories":[],"tags":["Docker","Linux"]},{"title":"about","url":"http://mosasaur.cn/about/index.html","content":"","categories":[],"tags":[]},{"title":"category","url":"http://mosasaur.cn/category/index.html","content":"","categories":[],"tags":[]},{"title":"link","url":"http://mosasaur.cn/link/index.html","content":"","categories":[],"tags":[]},{"title":"project","url":"http://mosasaur.cn/project/index.html","content":"","categories":[],"tags":[]},{"title":"search","url":"http://mosasaur.cn/search/index.html","content":"","categories":[],"tags":[]},{"title":"tag","url":"http://mosasaur.cn/tag/index.html","content":"","categories":[],"tags":[]}]