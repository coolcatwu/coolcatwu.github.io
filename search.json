[{"title":"基于ubuntu官方镜像构建JDK+Tomcat镜像","url":"http://mosasaur.cn/2017/08/15/基于ubuntu官方镜像构建JDK-Tomcat镜像/","content":"<h3 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h3><p>今天基于ubuntu16.04官方镜像使用Dockerfile制作JDK+Tomcat镜像，之前一直在看DOCKER DOSC，今天第一次开始实际操作，还是踩了不少的坑。</p>\n<h3 id=\"吹逼中\"><a href=\"#吹逼中\" class=\"headerlink\" title=\"吹逼中\"></a>吹逼中</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">FROM ubuntu:16.04</div></pre></td></tr></table></figure>\n<p>这个就不用多说了<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">LABEL auther=<span class=\"string\">\"wuchenzhi\"</span></div></pre></td></tr></table></figure></p>\n<p>自己写的Dockerfile还是署个名吧，这里使用标签，官方的意思是尽量使用LABEL，不要再使用MAINTAINER了，那就LABEL吧！<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">ADD jdk-8u91-linux-x64.gz /usr/<span class=\"built_in\">local</span>/</div><div class=\"line\">ADD apache-tomcat-8.5.6.tar.gz /usr/<span class=\"built_in\">local</span>/</div></pre></td></tr></table></figure></p>\n<p>使用ADD的时候就遇到坑了，可能是自己官方文档看得不仔细，一开始我把压缩文件ADD到/usr/local后，还使用RUN tar 试图解压文件，但build时报错，文件不存在，回去仔细看文档才发现，ADD命令会自动解压其能识别的压缩方式，后来想想也是，如果需要手动解压，那还需要再手动删除，太麻烦，docker帮我们干了<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">RUN /bin/bash -c <span class=\"string\">'apt-get update;apt-get -y install vim'</span></div></pre></td></tr></table></figure></p>\n<p>RUN 在Linux上默认使用/bin/sh 部分命令还是不能运行的，个人倾向使用/bin/bash<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\">ENV JAVA_HOME /usr/<span class=\"built_in\">local</span>/jdk1.8.0_91</div><div class=\"line\">ENV JRE_HOME <span class=\"variable\">$JAVA_HOME</span>/jre</div><div class=\"line\">ENV CLASSPATH <span class=\"variable\">$JAVA_HOME</span>/lib:<span class=\"variable\">$JRE_HOME</span>/lib</div><div class=\"line\">ENV PATH <span class=\"variable\">$PATH</span>:<span class=\"variable\">$JAVA_HOME</span>/bin:</div><div class=\"line\">ENV TOMCAT_HOME /usr/<span class=\"built_in\">local</span>/apache-tomcat-8.5.6</div></pre></td></tr></table></figure></p>\n<p>ENV 是很好用的，它不光能在Dockerfile生效，还能生效于镜像所生成的容器实例（之前还想着RUN 来修改…）<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">EXPOSE 8080</div><div class=\"line\">CMD [<span class=\"string\">\"/bin/bash\"</span>]</div></pre></td></tr></table></figure></p>\n<h3 id=\"DOCKERFILE\"><a href=\"#DOCKERFILE\" class=\"headerlink\" title=\"DOCKERFILE\"></a>DOCKERFILE</h3><p>最后来个完整的Dockerfile，我的第一篇博文就算结束了，不是很满意，以后回来再改过<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div></pre></td><td class=\"code\"><pre><div class=\"line\">FROM ubuntu:16.04</div><div class=\"line\">LABEL auther=<span class=\"string\">\"wuchenzhi\"</span></div><div class=\"line\">ADD jdk-8u91-linux-x64.gz /usr/<span class=\"built_in\">local</span>/</div><div class=\"line\">ADD apache-tomcat-8.5.6.tar.gz /usr/<span class=\"built_in\">local</span>/</div><div class=\"line\">RUN /bin/bash -c <span class=\"string\">'apt-get update;apt-get -y install vim'</span></div><div class=\"line\">ENV JAVA_HOME /usr/<span class=\"built_in\">local</span>/jdk1.8.0_91</div><div class=\"line\">ENV JRE_HOME <span class=\"variable\">$JAVA_HOME</span>/jre</div><div class=\"line\">ENV CLASSPATH <span class=\"variable\">$JAVA_HOME</span>/lib:<span class=\"variable\">$JRE_HOME</span>/lib</div><div class=\"line\">ENV PATH <span class=\"variable\">$PATH</span>:<span class=\"variable\">$JAVA_HOME</span>/bin:</div><div class=\"line\">ENV TOMCAT_HOME /usr/<span class=\"built_in\">local</span>/apache-tomcat-8.5.6</div><div class=\"line\">EXPOSE 8080</div><div class=\"line\">CMD [<span class=\"string\">\"/bin/bash\"</span>]</div></pre></td></tr></table></figure></p>\n","categories":[],"tags":["Docker","Linux"]},{"title":"about","url":"http://mosasaur.cn/about/index.html","content":"","categories":[],"tags":[]},{"title":"link","url":"http://mosasaur.cn/link/index.html","content":"","categories":[],"tags":[]},{"title":"search","url":"http://mosasaur.cn/search/index.html","content":"","categories":[],"tags":[]},{"title":"category","url":"http://mosasaur.cn/category/index.html","content":"","categories":[],"tags":[]},{"title":"project","url":"http://mosasaur.cn/project/index.html","content":"","categories":[],"tags":[]},{"title":"tag","url":"http://mosasaur.cn/tag/index.html","content":"","categories":[],"tags":[]}]